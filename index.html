<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebGIS Risk Application</title>

    <!-- Core CSS Dependencies -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

    <!-- Leaflet Plugin CSS -->
    <link href="src/plug/L.Control.Sidebar.css" rel="stylesheet">
    <link href="src/plug/MarkerCluster.css" rel="stylesheet">
    <link href="src/plug/MarkerCluster.Default.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">
    <link rel="stylesheet" href="src/plug/leaflet-draw/leaflet.draw.css"/>

    <!-- Core JavaScript Dependencies -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>

    <!-- Leaflet Core and Plugins -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-tilelayer-swiss@2.3.0/dist/Leaflet.TileLayer.Swiss.umd.js" crossorigin integrity="sha384-M4p8VfZ8RG6qNiPYA3vOCApQXAlLtnJXVPdydMYPAsvvIDsWp2dqqzF2OEeWWNhy"></script>
    <script src="src/plug/leaflet.ajax.min.js"></script>
    <script src="src/plug/L.Control.Sidebar.js"></script>
    <script src="src/plug/leaflet-providers.js"></script>
    <script src="src/plug/leaflet.markercluster.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>

    <!-- Charts and Data Grid -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ag-grid-community/dist/ag-grid-community.min.js"></script>

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Raster Processing -->
    <script src="https://cdn.jsdelivr.net/npm/geotiff"></script>
    <script src="//d3js.org/d3.v4.min.js"></script>
    <script src="//npmcdn.com/geotiff@0.3.6/dist/geotiff.js"></script>
    <script src="https://ihcantabria.github.io/Leaflet.CanvasLayer.Field/dist/leaflet.canvaslayer.field.js"></script>

    <!-- Data Files -->
    <script src="src/js/tessin_hazards.js"></script>
    
    <!-- Custom Functions -->
    <script src="src/js/functions_2.js"></script>
    <script src="src/js/map-init.js"></script>
    <script src="src/js/supabase-buildings.js"></script>
    <script src="src/js/app.js"></script>

    <!-- Custom Styles -->
    <link rel="stylesheet" href="src/css/main-styles.css">
</head>
<body>
    <div class="container-fluid">
        <!-- Header -->
        <div class="row">
            <div class="header col-sm-12">
                <div class="header-left">
                    <img src="data/images/logo.jpeg" alt="Logo" class="header-logo">
                    <h4>Web GIS Application for Natural Hazards Risk Assessment</h4>
                </div>
                <div class="theme-switch-wrapper">
                    <span class="theme-label">Dark Mode</span>
                    <label class="theme-switch">
                        <input type="checkbox" id="theme-toggle">
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
        </div>
        
        <!-- Main Content: Sidebar + Map -->
        <div class="row"> 
            <!-- Sidebar -->
            <div id="side-bar" class="tabs col-sm-3">
                <div id="tabs" class="control-panel">
                    <ul>
                        <li><a href="#tabs-1">Visualization</a></li>
                        <li><a href="#tabs-2">Analysis</a></li>
                    </ul>
                    
                    <!-- Visualization Tab -->
                    <div id="tabs-1">
                        <h4>Select layers for Visualization</h4>
                                    
                        <!-- Buildings Layer -->
                        <div class="align-lyr-1 col-sm-12" style="border-top-style:solid">              
                            <div class="col-sm-8 col-xl-8">
                                <h5>Buildings</h5>
                            </div>
                            <div class="col-sm-4 col-xl-4">
                                <img id="build-hide-show" src="src/images/caret-down-square.svg" role="button" alt="Button to open menu" aria-label="Press enter to open building layer">
                            </div>                      
                        </div>
                        <div id="fr-build-1" class="align-lyr-2 col-sm-12">                
                            <button id="fr-add-buil-lyr" type="button" class="button btn btn-primary btn-sm">Add</button>
                            <button id="fr-rem-buil-lyr" type="button" class="button btn btn-danger">Remove</button>    
                            <button id="fr-att-table" type="button" class="button btn btn-warning">Attributes</button>  
                            <button id="fr-info" type="button" class="button btn btn-info">Info</button>      
                        </div>
                        <div id="fr-build-2" class="align-lyr-3 col-sm-12 flex-container">        
                            <div class="flex-grow-2">
                                <h5>Opacity: </h5>
                            </div>
                            <div class="flex-grow-1">
                                <h5 id="op-val"></h5>                    
                            </div>
                            <div class="flex-grow-9">
                                <input id="fr-build-slider" class="slider" type="range" min="0.0" max="1.0" step="0.1" value="1">     
                            </div>                      
                        </div> 
                        <br>

                        <!-- Rockfall Hazard Map -->
                        <div class="align-lyr-1 col-sm-12" style="border-top-style:solid">              
                            <div class="col-sm-8 col-xl-8">
                                <h5>Rockfall hazard map</h5>
                            </div>
                            <div class="col-sm-4 col-xl-4">
                                <img id="rockfall-hide-show" src="src/images/caret-down-square.svg" role="button" alt="Button to open menu" aria-label="Press enter to open rockfall hazard map layer">
                            </div>                      
                        </div>
                        <div id="rock-div-1" class="align-lyr-2 col-sm-12">                
                            <button id="add-rock-lyr" type="button" class="button btn btn-primary btn-sm">Add</button>
                            <button id="rem-rock-lyr" type="button" class="button btn btn-danger">Remove</button>    
                            <button id="att-rock-table" type="button" class="button btn btn-warning">Attributes</button>  
                            <button id="info-rock-lyr" type="button" class="button btn btn-info">Info</button>      
                        </div>
                        <div id="rock-div-2" class="align-lyr-3 col-sm-12 flex-container">        
                            <div class="flex-grow-2">
                                <h5>Opacity: </h5>
                            </div>
                            <div class="flex-grow-1">
                                <h5 id="op-val-rock"></h5>                    
                            </div>
                            <div class="flex-grow-9">
                                <input id="rock-slider" class="slider" type="range" min="0.0" max="1.0" step="0.1" value="1">     
                            </div>                      
                        </div>
                        <div id="rock-legend" class="align-lyr-3 col-sm-12" style="margin-top: 10px;">
                            <h5>Legend</h5>
                            <img src="src/images/rockfall-legend.png" alt="Rockfall legend" style="max-width: 100%; height: auto;">
                        </div> 
                        <br>

                        <!-- DEM Raster Layer -->
                        <div class="align-lyr-1 col-sm-12" style="border-top-style:solid">              
                            <div class="col-sm-8 col-xl-8">
                                <h5>DEM</h5>
                            </div>
                            <div class="col-sm-4 col-xl-4">
                                <img id="dem-hide-show" src="src/images/caret-down-square.svg" role="button" alt="Button to open menu" aria-label="Press enter to open digital elevation model layer">
                            </div>                      
                        </div>
                        <div id="dem-1" class="align-lyr-2 col-sm-12">                
                            <button id="add-dem" type="button" class="button btn btn-primary btn-sm">Add</button>
                            <button id="rem-dem" type="button" class="button btn btn-danger">Remove</button>    
                            <button id="att-dem" type="button" class="button btn btn-warning">Attributes</button>  
                            <button id="info-dem" type="button" class="button btn btn-info">Info</button>      
                        </div>
                        <div id="dem-2" class="align-lyr-3 col-sm-12 flex-container">        
                            <div class="flex-grow-2">
                                <h5>Opacity: </h5>
                            </div>
                            <div class="flex-grow-1">
                                <h5 id="op-val-dem"></h5>                    
                            </div>
                            <div class="flex-grow-9">
                                <input id="dem-slider" class="slider" type="range" min="0.0" max="1.0" step="0.1" value="1">     
                            </div>                      
                        </div>                   
                        <br>
                    </div>

                    <!-- Analysis Tab -->
                    <div id="tabs-2">
                        <h4>Draw polygon with keyboard</h4>
                        <button id="draw-poly" type="button" class="button btn btn-secondary">Start polygon</button> 
                        <hr style="height:2px; background-color:#9fa6a3"> 

                        <h4>Select options for analysis</h4>     
                        <!-- Select extent area-->
                        <div id="area">
                            <div class="col-sm-12">                                
                                <select id="type-sel" class="form-control form-control-lg space-selectors">
                                    <option value="0">Extent area</option>
                                    <option value="1">Administrative boundary</option>
                                    <option value="2">Drawn polygon</option>
                                </select>                
                            </div>
                        </div>

                        <!-- Select Canton-->
                        <div id="canton" class="col-sm-12">                                
                            <select id="area-sel" class="form-control form-control-lg space-selectors">
                                <option value="0">Commune / Polygon</option>
                            </select>                
                        </div>
                        
                        <!-- Select Hazard-->
                        <div id="hazard" class="col-sm-12">                                
                            <select id="hazard-sel" class="form-control form-control-lg space-selectors">
                                <option value="0">Type of Hazard</option>
                                <option value="1">Debris flow</option>
                                <option value="2">Rockfall</option>
                                <option value="3">Flooding</option>
                            </select>                
                        </div>

                        <!-- Select Elements at risk-->
                        <div id="elemts" class="col-sm-12">                                
                            <select id="elemts-sel" class="form-control form-control-lg space-selectors">
                                <option value="0">Elements at Risk</option>
                                <option value="1">Buildings</option>
                            </select>                
                        </div>

                        <!-- Analysis buttons -->                      
                        <button id="run-analysis" type="button" class="button btn btn-info" disabled>Run analysis</button>
                        <button id="show-table" type="button" class="button btn btn-warning" disabled>Show results</button>  
                                                
                        <!-- Vulnerability curves -->   
                        <hr style="height:2px; background-color:#9fa6a3">
                        <h4>Parameters for vulnerability curves</h4>  

                        <!-- Show vulnerability curves -->
                        <div class="align-lyr-1 col-sm-12">              
                            <div class="col-sm-9 col-xl-9">
                                <h5>Visualize curves</h5>
                            </div>
                            <div class="col-sm-3 col-xl-3">
                                <img id="show-vuln-graph" src="src/images/graph-up.svg" alt="Vulnerability Graph">
                            </div>                      
                        </div>

                        <!-- Download JSON file -->
                        <div class="align-lyr-1 col-sm-12">              
                            <div class="col-sm-9 col-xl-9">
                                <h5>Download parameters file</h5>
                            </div>
                            <div class="col-sm-3 col-xl-3">
                                <img id="downloadButton" src="src/images/cloud-download.svg" alt="Download">
                            </div>                      
                        </div>

                        <!-- Upload JSON file -->
                        <div class="align-lyr-1 col-sm-12">              
                            <div class="col-sm-9 col-xl-9">
                                <h5>Upload parameters file</h5>
                            </div>
                            <div class="col-sm-3 col-xl-3">
                                <img id="uploadButton" src="src/images/cloud-upload.svg" alt="Upload">
                            </div>                      
                        </div> 
                        <input type="file" class="form-control-file" id="uploadInput" accept=".json" style="display: none;">
                        
                        <hr style="height:2px; background-color:#9fa6a3">
                        <button id="show-report" type="button" class="button btn btn-success" disabled>Show report</button>   
                    </div>
                </div>
            </div>

            <!-- Map Container -->
            <div class="col-sm-9">
                <div class="map-div">
                    <!-- 2D Map Container -->
                    <div id="map" class="map-style"></div>
                    <!-- Coordinates bar -->
                    <div class="coord-style">
                        <div id="coordinates"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="spinner" class="spinner" style="display: none;"></div>

</body>
</html>
