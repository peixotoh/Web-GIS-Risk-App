<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebGIS Risk Application</title>

    <!-- Core CSS Dependencies -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

    <!-- Leaflet Plugin CSS -->
    <link href="src/plug/L.Control.Sidebar.css" rel="stylesheet">
    <link href="src/plug/MarkerCluster.css" rel="stylesheet">
    <link href="src/plug/MarkerCluster.Default.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">

    <!-- Core JavaScript Dependencies -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Leaflet Core and Plugins -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-tilelayer-swiss@2.3.0/dist/Leaflet.TileLayer.Swiss.umd.js" crossorigin integrity="sha384-M4p8VfZ8RG6qNiPYA3vOCApQXAlLtnJXVPdydMYPAsvvIDsWp2dqqzF2OEeWWNhy"></script>
    <script src="src/plug/leaflet.ajax.min.js"></script>
    <script src="src/plug/L.Control.Sidebar.js"></script>
    <script src="src/plug/leaflet-providers.js"></script>
    <script src="src/plug/leaflet.markercluster.js"></script>
    
    <!-- Leaflet Draw Plugin (Full CDN Version) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>

    <!-- Charts and Data Grid -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ag-grid-community/dist/ag-grid-community.min.js"></script>

    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Data Files -->
    <script src="data/json/suisse_admin_lim.js"></script>
    <script src="data/json/ti_buildings.js"></script>
    <script src="data/json/debris_flow_hazards.js"></script>
    <script src="data/json/rockfall_hazards.js"></script>
    <script src="data/json/flooding_hazards.js"></script>
    
    <!-- Custom Functions -->
    <script src="src/js/functions_2.js"></script>
    <script src="src/js/map-init.js"></script>
    <script src="src/js/supabase-buildings.js"></script>
    <script src="src/js/app.js"></script>

    <!-- Custom Styles -->
    <link rel="stylesheet" href="src/css/main-styles.css">
</head>
<body>
    <div class="container-fluid">
        <!-- Header -->
        <div class="row">
            <div class="header col-sm-12">
                <div class="header-left">
                    <img src="data/images/logo.jpeg" alt="Logo" class="header-logo">
                    <h4>Web GIS Application for Natural Hazards Risk Assessment</h4>
                </div>
                <div class="header-controls">
                    <button id="reset-map-btn" class="reset-btn" title="Reset Map">
                        üè†
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Main Content: Sidebar + Map -->
        <div class="row"> 
            <!-- Sidebar -->
            <div id="side-bar" class="col-sm-3">
                <div class="workflow-panel">
                    <h3 class="workflow-title">Risk Analysis Workflow</h3>
                    
                    <!-- 1. Location Section -->
                    <div class="workflow-section">
                        <h4 class="section-title">
                            <span class="step-number">1</span>
                            Location
                        </h4>
                        <div class="section-content">
                            <!-- Canton Dropdown -->
                            <div class="form-group">
                                <label for="canton-select">Canton</label>
                                <select id="canton-select" class="form-control">
                                    <option value="">Select Canton</option>
                                    <option value="vs">Valais</option>
                                    <option value="ti">Ticino</option>
                                    <option value="gr">Grisons</option>
                                    <option value="be">Bern</option>
                                    <option value="ur">Uri</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            
                            <!-- Commune Dropdown -->
                            <div class="form-group">
                                <label for="commune-select">Commune</label>
                                <select id="commune-select" class="form-control" disabled>
                                    <option value="">Select Commune</option>
                                </select>
                            </div>
                            
                            <!-- Polygons Dropdown -->
                            <div class="form-group">
                                <label for="polygon-select">Drawn Polygons</label>
                                <select id="polygon-select" class="form-control" disabled>
                                    <option value="">No polygons available</option>
                                </select>
                                <small class="form-text text-muted">
                                    Draw polygons on the map to see them here
                                </small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- 2. Hazards Section -->
                    <div class="workflow-section">
                        <h4 class="section-title">
                            <span class="step-number">2</span>
                            Hazard Maps
                        </h4>
                        <div class="section-content">
                            <!-- Rockfall Toggle -->
                            <div class="hazard-toggle">
                                <label class="toggle-container">
                                    <span class="toggle-label">Rockfall Hazard</span>
                                    <label class="switch">
                                        <input type="radio" name="hazard-type" id="rockfall-toggle" value="rockfall">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </label>
                            </div>
                            
                            <!-- Debris Flow Toggle -->
                            <div class="hazard-toggle">
                                <label class="toggle-container">
                                    <span class="toggle-label">Debris Flow Hazard</span>
                                    <label class="switch">
                                        <input type="radio" name="hazard-type" id="debris-flow-toggle" value="debris-flow">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </label>
                            </div>
                            
                            <small class="form-text text-muted">
                                Only one hazard type can be displayed at a time
                            </small>
                        </div>
                    </div>
                    
                    <!-- 3. Buildings Section -->
                    <div class="workflow-section">
                        <h4 class="section-title">
                            <span class="step-number">3</span>
                            Buildings
                        </h4>
                        <div class="section-content">
                            <div class="building-toggle">
                                <label class="toggle-container">
                                    <span class="toggle-label">Display Buildings on Map</span>
                                    <label class="switch">
                                        <input type="checkbox" id="buildings-toggle">
                                        <span class="toggle-slider"></span>
                                    </label>
                                </label>
                            </div>
                            
                            <small class="form-text text-muted">
                                Show/hide building layer on the map
                            </small>
                        </div>
                    </div>
                    
                    <!-- 4. Vulnerability Section -->
                    <div class="workflow-section">
                        <h4 class="section-title">
                            <span class="step-number">4</span>
                            Vulnerability
                        </h4>
                        <div class="section-content">
                            <button id="show-curves-btn" type="button" class="btn btn-info btn-block">
                                <img src="src/images/graph-up.svg" alt="Graph" style="width: 16px; height: 16px; margin-right: 8px;">
                                Show Curves
                            </button>
                            
                            <small class="form-text text-muted">
                                Display vulnerability curves and parameters
                            </small>
                        </div>
                    </div>
                    
                    <!-- 5. Analysis Section -->
                    <div class="workflow-section">
                        <h4 class="section-title">
                            <span class="step-number">5</span>
                            Analysis
                        </h4>
                        <div class="section-content">
                            <div class="analysis-buttons">
                                <button id="run-analysis-btn" type="button" class="btn btn-primary btn-block mb-2" disabled>
                                    Run Analysis
                                </button>
                                
                                <button id="show-results-btn" type="button" class="btn btn-warning btn-block" disabled>
                                    Show Results
                                </button>
                            </div>
                            
                            <small class="form-text text-muted">
                                Complete steps 1-4 to enable analysis
                            </small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Map Container -->
            <div class="col-sm-9">
                <div class="map-div">
                    <!-- 2D Map Container -->
                    <div id="map" class="map-style"></div>
                    <!-- Coordinates bar -->
                    <div class="coord-style">
                        <div id="coordinates"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="spinner" class="spinner" style="display: none;"></div>

</body>
</html>
